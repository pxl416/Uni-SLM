# ========= Datasets selection =========
active_datasets: ["CSL_Daily", "CSL_News"]
active_weights: [1.0, 0.5]     # Daily 占 2/3，News 占 1/3


datasets:
  CSL_Daily:
    modalities:
      rgb: true
      pose: false
      text: true

    paths:
      root: /home/pxl416/PeixiLiu/px_proj/Uni-SLM/data/mini_CSL_Daily/
      rgb: sentence
      pose: lmdb
      text: sentence_label/video_map.txt
      segments: sentence_label/video_map.txt

    splits:
      train: sentence_label/split_1_train.txt
      val:   sentence_label/split_1_dev.txt
      test:  sentence_label/split_1_test.txt

    temporal:
      T: 32
      jitter: false
      min_frames: 1
      max_frames: 128   # 每个视频最大长度

  CSL_News:
    modalities:
      rgb: true
      pose: true
      text: true

    paths:
      root: /home/pxl416/PeixiLiu/px_proj/Uni-SLM/data/mini_CSL_News
      rgb: rgb
      pose: pose
      text: ./
      segments: null       # CSLNews 没有 segmentation 标签，设 null

    splits:
      train: train_label.json
      val:   val_label.json
      test:  test_label.json

    temporal:
      T: 32
      jitter: false
      min_frames: 1
      max_frames: 256


# ========= Encoders & Projection =========
Encoders:
  rgb:
    output_dim: 512
  text:
    output_dim: 384

Pretraining:
  projection_dim: 256

# ========= Training generic =========
Training:
  batch_size: 8
  num_workers: 4
  epochs: 30
  learning_rate_head: 3e-4
  learning_rate_backbone: 5e-5
  grad_clip: 1.0
  max_length: 64  # 兜底，实际上面 temporal.T=32 会被读取并覆盖

# ========= Finetune control =========
Finetune:
  task: translation           # retrieval / recognition / translation
  train_split: dev          # 你日志里就是用 dev 做训练、test 做评估
  eval_split: test
  amp: true                 # 开启混合精度
  freeze: []                # 例: ["rgb","text","proj"]
  weights:                 # 如需加载单独权重可打开
    rgb_path: /home/pxl416/PeixiLiu/px_proj/Uni-SLM/config/checkpoints/pretrain_daily_1022_i3d_epoch30/weights/latest/rgb_encoder.pt
    text_path: /home/pxl416/PeixiLiu/px_proj/Uni-SLM/config/checkpoints/pretrain_daily_1022_i3d_epoch30/weights/latest/text_encoder.pt
    proj_rgb_path: /home/pxl416/PeixiLiu/px_proj/Uni-SLM/config/checkpoints/pretrain_daily_1022_i3d_epoch30/weights/latest/proj_rgb.pt
    proj_text_path: /home/pxl416/PeixiLiu/px_proj/Uni-SLM/config/checkpoints/pretrain_daily_1022_i3d_epoch30/weights/latest/proj_text.pt


# ========= Evaluation heads config (dims需与你模型一致) =========
Evaluation:
  retrieval:
    mode: True
    rgb_in: 512
    text_in: 384
    proj_dim: 256
    temperature: 0.07
  recognition:
    mode: True
    in_dim: 512
    num_classes: 2000
    hidden_dim: 512
    num_layers: 2
    dropout: 0.1
    blank_id: 0
  translation:
    mode: True

    # ========== 模型选择 ==========
    model_type: mt5                     # mt5 / t5 / llama / qwen / mistral
    model_path: google/mt5-base         # huggingface 路径
    tokenizer_path: google/mt5-base     # 可分开设置（对 LLaMA 有用）

    # ========== 视觉输入映射 ==========
    in_dim: 512                         # RGB encoder 输出维度
    d_model: 768                        # 映射到语言模型 hidden size
    max_video_len: 256                  # 可选：用于位置编码

    # ========== prompt ==========
    prompt: "Translate sign language video to Chinese:"
    lang: zh                            # 可用于 tokenizer lang 设置

    # ========== 损失函数 ==========
    label_smoothing: 0.1

    # ========== 生成参数（训练/推理通用） ==========
    max_target_len: 128
    max_new_tokens: 64
    num_beams: 4

    # ========== 编码模式（对 T5 / LLaMA 重要） ==========
    encode_mode: encoder_outputs         # 或者 inputs_embeds


# ========= Basic =========
seed: 3407
save_dir: /home/pxl416/PeixiLiu/px_proj/Uni-SLM/checkpoints/finetune
# ========= W&B (可选) =========
wandb:
  use: true
  project: uni-slm-finetune
  run_name: csl-daily-split1-1121
